# Test targets for Flucture
# Include this in your main Makefile or use directly from build/

.PHONY: test-unit test-db test-fast test-all

test-unit:
	@echo "=== Running Unit Tests ==="
	@./flucture_tests "~[db]~[slow]~[integration]~[ai]~[llm]~[disabled]"

test-db:
	@echo "=== Running Database Tests ==="
	@if [ ! -f ../.env ]; then \
		echo "ERROR: .env file not found"; \
		exit 1; \
	fi
	@. ../.env && \
		if [ -z "$$DB_HOST" ] || [ -z "$$DB_USER" ] || [ -z "$$DB_PASS" ]; then \
			echo "ERROR: DB_HOST, DB_USER, and DB_PASS must be set in .env"; \
			exit 1; \
		fi && \
		export DB_PORT=$${DB_PORT:-5432} && \
		export DB_NAME=$${DB_NAME:-test_db} && \
		./flucture_tests "[db]~[slow]"

test-fast:
	@echo "=== Running All Fast Tests ==="
	@./flucture_tests "~[slow]~[disabled]"

test-all:
	@echo "=== Running Complete Test Suite ==="
	@if [ ! -f ../.env ]; then \
		echo "ERROR: .env file not found"; \
		exit 1; \
	fi
	@. ../.env && \
		if [ -z "$$DB_HOST" ] || [ -z "$$DB_USER" ] || [ -z "$$DB_PASS" ]; then \
			echo "ERROR: DB_HOST, DB_USER, and DB_PASS must be set in .env"; \
			exit 1; \
		fi && \
		export DB_PORT=$${DB_PORT:-5432} && \
		export DB_NAME=$${DB_NAME:-test_db} && \
		if [ -z "$$OPENAI_API_KEY" ]; then \
			echo "ERROR: OPENAI_API_KEY not set in .env"; \
			exit 1; \
		fi && \
		./flucture_tests "~[disabled]"

# Helper to list all tests
test-list:
	@./flucture_tests --list-tests

# Helper to list all tags
test-tags:
	@./flucture_tests --list-tags
